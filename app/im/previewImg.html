<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="js/3rd/magnify-master/jquery.magnify.min.css">
  <style>
    html,
    body {
      padding: 0;
      margin: 0;
    }

    .preview-box {
      /* height: 100%; */
    }

    .preview-pic {
      /* visibility: hidden; */
      display: none;
    }

    /* 图片预览样式修改 */
    .magnify-modal .magnify-stage {
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      border-width: 0;
    }

    .magnify-modal .magnify-image {
      cursor: pointer;
    }

    .magnify-modal .magnify-button {
      opacity: 0.5;
    }

    .magnify-modal .magnify-button:hover {
      opacity: 1;
    }

    .magnify-modal .magnify-button-close {
      width: 90px;
      height: 90px;
    }

    .magnify-modal .magnify-button-prev,
    .magnify-modal .magnify-button-next {
      width: 90px;
      height: calc(100% - 180px);
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      transition: all .5s;
    }

    .magnify-modal .magnify-button-prev {
      left: 0px;

    }

    .magnify-modal .magnify-button-next {
      right: 0px;
    }

    .magnify-modal .magnify-button-prev:hover,
    .magnify-modal .magnify-button-next:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }
  </style>

</head>

<body>
  <div class="preview-box" id="previewBox">
    <div class="img-box">
    </div>
  </div>
  <script src="../3rd/jquery-1.11.3.min.js"></script>
  <script>
    if (typeof module === 'object') {
      window.jQuery = window.$ = module.exports;
    };
  </script>
  <script src="js/3rd/magnify-master/jquery.magnify.min.js"></script>
  <script>
    const remote = require('electron').remote;
    const ipcRenderer = require('electron').ipcRenderer
    var ctrWindow = remote.getCurrentWindow()

    function previewImg() {
      $('#previewBox .preview-pic').magnify({
        initMaximized: true,
        multiInstances: false,
        headToolbar: [
          'close'
        ],
        footToolbar: [
          'zoomIn',
          'zoomOut',
          'prev',
          'next',
          'actualSize',
          'rotateLeft',
          'rotateRight'
        ],
        progressiveLoading: false,
        callbacks: {
          beforeOpen: function (el) {},
          opened: function (el) {
            setTimeout(() => {
              var str = '第' + (this.groupIndex + 1) + '张图片，共' + this.groupData.length + '张'
              this.$title.text(str)
            }, 0);
            // 第一张
            this.groupIndex === 0 && this.$prev.hide()
            // 最后一张
            this.groupIndex + 1 === this.groupData.length && this.$next.hide()
            $('.magnify-stage').click(function (ev) {
              if (!$(ev.target).is('.magnify-image')) {
                $('.magnify-modal').remove()
                ctrWindow.close()
              }
            })
            // Will fire after modal is opened
          },
          beforeClose: function (el) {
            // Will fire before modal is closed
          },
          closed: function (el) {
            // Will fire after modal is closed
            ctrWindow.close()
          },
          beforeChange: function (index) {
            // console.log(index)
            // Will fire before image is changed
            // The arguments is the current image index of image group
          },
          changed: function (index) {
            var str = '第' + (this.groupIndex + 1) + '张图片，共' + this.groupData.length + '张'
            this.$title.text(str)
            // 第一张
            this.groupIndex === 0 ? this.$prev.hide() : this.$prev.show()
            // 最后一张
            this.groupIndex + 1 === this.groupData.length ? this.$next.hide() : this.$next.show()
            // Will fire after image is changed
            // The arguments is the next image index of image group
          }
        }
      });
    }
    ipcRenderer.on('imgMessage', (event, data) => {
      for (let i = 0; i < data.data.length; i++) {
        const url = data.data[i];
        var _html = `<img class="preview-pic" data-caption=" " src=${url} data-src=${url}  />`
        $('.img-box').append(_html)
      }
      previewImg()
      if ($('#previewBox .preview-pic').length > 0) {
        $('#previewBox .preview-pic').eq(data.index).click()
      }
    })
  </script>
</body>

</html>